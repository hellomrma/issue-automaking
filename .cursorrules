# Cursor Rules for 티스토리 글 자동 생성

## 프로젝트 개요

티스토리 블로그 글 자동 생성 웹 서비스입니다. Google Trends에서 인기 키워드를 수집하거나 URL 콘텐츠를 분석하여 Anthropic Claude API로 마크다운 블로그 글을 생성합니다.

## 기술 스택

- Python 3.10+
- FastAPI + Uvicorn (백엔드)
- Anthropic Claude API (글 생성)
- trendspyg (Google Trends)
- DuckDuckGo Search (웹/뉴스 검색)
- HTML/CSS/JS (프론트엔드, static 폴더)

## 프로젝트 구조

```
app/
├── main.py          # FastAPI 앱, API 엔드포인트
├── writer.py        # Claude API 글 생성 로직
├── trends.py        # Google Trends 키워드 수집
├── search.py        # 웹 검색, URL 콘텐츠 추출
└── rate_limit.py    # 인메모리 Rate Limiter

static/              # 프론트엔드 정적 파일
tests/               # pytest 테스트
```

## 코딩 규칙

### Python
- Python 3.10+ 타입 힌트 필수 사용
- Pydantic `field_validator`로 입력 검증
- 로깅: `logger = logging.getLogger("app.모듈명")` 패턴
- 한국어 주석 및 사용자 대면 메시지
- docstring은 한국어 또는 영어 혼용 가능

### FastAPI
- 요청 모델은 Pydantic `BaseModel` 상속
- Rate Limiting은 `Depends(rate_limit(limiter))` 패턴
- 에러 응답은 `HTTPException`으로 처리
- 스트리밍 응답은 `StreamingResponse` 사용

### 테스트
- pytest 사용
- API 테스트: `httpx` 또는 `TestClient`
- Rate Limiter 테스트 전 `limiter.requests.clear()` 호출

## 자주 사용하는 명령어

```bash
# 서버 실행
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 테스트
pytest
pytest --cov=app --cov-report=term-missing

# 의존성 설치
python -m pip install -r requirements.txt
```

## 환경 변수

- `ANTHROPIC_API_KEY`: Claude API 키 (필수 또는 웹에서 입력)
- `CLAUDE_MODEL`: Claude 모델 ID (기본: claude-sonnet-4-20250514)
- `USE_CSV_TRENDS`: CSV 트렌드 수집 활성화 (기본: false)

## API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | /api/regions | 지원 지역 목록 |
| GET | /api/trends | 인기 검색어 조회 |
| POST | /api/generate | 키워드 기반 글 생성 |
| POST | /api/generate/stream | 키워드 기반 글 스트리밍 |
| POST | /api/generate-from-url | URL 기반 글 생성 |
| POST | /api/generate-from-url/stream | URL 기반 글 스트리밍 |

## 주요 함수

### writer.py
- `generate_article_md(keyword, ...)`: 키워드로 마크다운 글 생성
- `generate_article_from_url(url_content, ...)`: URL 콘텐츠로 글 생성
- `_build_prompts()`: 키워드 기반 프롬프트 생성
- `_build_url_prompts()`: URL 기반 프롬프트 생성

### trends.py
- `get_trending_keywords(region, limit)`: Google Trends 키워드 수집
- `TrendsCache`: 10분 TTL 캐시

### search.py
- `search_web(keyword, ...)`: DuckDuckGo 웹+뉴스 검색
- `fetch_url_content(url)`: URL에서 제목/본문/메타 추출
- `search_related_to_url(url, ...)`: URL 분석 + 관련 검색

## 코드 작성 시 참고사항

1. 새 API 엔드포인트 추가 시 `app/main.py`에 작성
2. Rate Limiting이 필요한 엔드포인트는 `Depends(rate_limit(...))` 추가
3. 사용자 입력은 Pydantic 모델로 검증
4. 외부 API 호출 실패 시 적절한 에러 메시지 반환
5. 긴 작업은 스트리밍 버전(`/stream`) 제공 고려
